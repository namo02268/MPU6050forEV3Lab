# MPU6050 for EV3 Lab

## 概要 (Overview)
**MPU6050** を EV3 で使用するための LEGO MINDSTORMS EV3 向け拡張プログラミングブロックです。  
簡単なハードウェア加工を行うことで、Arduino などのマイコンを介さずに **EV3 から直接 MPU6050（加速度・ジャイロセンサー）と I2C 通信**を行うことができます。

## 使用上の注意点
本ブロックを使用するには、**MPU6050 モジュールに対してハードウェア上の変更が必要**です。

> [!WARNING]
> 以下の作業には、はんだ付けなどの改造作業が含まれます。  
> 実施は **自己責任** で行ってください。

### プルアップ抵抗の交換

MPU6050 を EV3 で使用する場合、**MPU6050 モジュール側に実装されている I2C プルアップ抵抗の変更が必要です**。

一般的な MPU6050 モジュールには、I2C（SCL / SDA）用として **`4.7kΩ` のプルアップ抵抗** が実装されています（下図 R4 / R5）。

![](./images/README_Resisters.jpg)
> Amazon で購入した「GY-521 MPU6050 3軸加速度計・ジャイロモジュール」

一方、LEGO MINDSTORMS EV3 のセンサーポートでは、  
**外部 I2C デバイス側のプルアップ抵抗値として `82kΩ` が LEGO 公式により推奨されています**。

![](./images/README_Resisters_Recuired.jpg)

>出典：LEGO Education, EV3 Hardware Developer Kit
>https://education.lego.com/en-us/product-resources/mindstorms-ev3/downloads/developer-kits/

そのため、MPU6050 を EV3 に接続して使用する場合は、以下の対応を行ってください。

- **MPU6050 モジュールに実装されている `4.7kΩ` のチップ抵抗を取り外す**
- **LEGO 公式の推奨に従い、`82kΩ` の抵抗に交換する**

> [!Note]
> `47kΩ` や `100kΩ` の抵抗値でも動作確認は取れています。

### 電源電圧について
MPU6050の動作電圧は `2.375V-3.46V` ですが、EV3 のセンサーポートからは **`5V` が出力されます**。
そのため、MPU6050 を直接接続して使用する場合は、**`5V` 入力を受けて内部で `3.3V` に降圧できる LDO（レギュレータ）を搭載した MPU6050 モジュールが必須です**。

一般的な MPU6050 モジュールにはレギュレータが搭載されているはずですが、一部の簡易モジュールでは搭載されていない可能性もあるため、事前に仕様を確認してください。

## 改造方法と EV3 との接続
### 手順 1：プルアップ抵抗を外す
MPU6050 モジュール上の **SDA / SCL 用プルアップ抵抗**を取り外します。  
はんだごてを数秒当てることで、比較的簡単に取り外すことができます。


### 手順 2：EV3と配線する
EV3 コネクタの各端子を、MPU6050 の端子に次のように接続してください。

- SDA → SDA  
- SCL → SCL  
- 5V → 5V  
- GND → GND  

また、**5V と SDA / SCL の間に `82kΩ` のプルアップ抵抗**を接続します。

> [!NOTE]  
> `47kΩ` や `100kΩ` の抵抗値でも動作確認は取れています。

![](./images/README_Circuit.jpg)

## 拡張ブロックのインストール方法 (Installation)
- [Releases ページ](https://github.com/namo02268/MPU6050forEV3Lab/releases)より 「MPU6050.ev3b」 をダウンロード
- EV3ソフトウェアを起動し、[ツール] > [ブロック インポート] を開く
- ダウンロードした .ev3b ファイルを読み込む
- EV3ソフトウェアを再起動
- 追加されたブロックをプログラムにドラッグ＆ドロップして使用

## 拡張ブロックの使用方法
### 測定モード
加速度、ジャイロ（角速度）、温度を測定できます。  
それぞれの出力単位は以下の通りです。

- 加速度：[G]  
- 角速度：[°/s]  
- 温度：[°]

角速度を時間で積分することで角度を求めることも可能ですが、
**EV3 の I2C 通信速度は低いため、角度計算の精度は高くありません。**

![](./images/README_Measure.jpg)

### 比較モード
測定した値を、設定した閾値と比較するモードです。  
比較結果は **真偽値（True / False）** として出力されます。
スイッチやループブロックからも使用できます。

![](./images/README_Compare.jpg)
